@using System.Linq
@using System.Web.Mvc
@using System.Web.Mvc.Html
@using m4dModels

@helper UndoUser(System.Web.Mvc.HtmlHelper html, Song song, SongFilter filter, string userName=null)
{
    var title = userName;
    var toggle = string.Empty;
    var id = "userUndo";

    if (userName == null && User.Identity.IsAuthenticated && song.ModifiedBy.Any(mr => mr.UserName == User.Identity.Name))
    {
        userName = User.Identity.Name;
        title = "Undo My Changes";
        toggle = "visible:!changed()";
    }
    else if (userName != null)
    {
        id = "userUndo-" + userName;
    }

    if (userName == null) {return;}

    using (html.BeginForm("UndoUserChanges", "Song", FormMethod.Post, new { @class = "form-inline", role = "form" }))
    {
        @html.AntiForgeryToken()
        <input type="hidden" name="filter" value="@filter" />
        <input type="hidden" name="id" value="@song.SongId" />
        <input type="submit" id="@id" name="undo" value="@title" class="btn" data-bind="@toggle" />
    }
}
