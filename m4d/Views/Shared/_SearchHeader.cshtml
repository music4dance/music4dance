@model m4d.ViewModels.SearchHeaderModel

@{
    var description = Model.Description;
    var dances = Model.Dances;
    var userName = Model.UserName;
    var filter = Model.Filter;
}

@if (string.IsNullOrWhiteSpace(Model.Description))
{
    @if (Model.Filter.IsAdvanced)
    {
        // Advanced Header
        var url = "/song/" + (filter.IsRaw ? "raw" : "advanced") + "searchform?filter=" + filter;
        <h1>
            Search Results
            @if (filter.IsRaw)
            {
                <text> (RAW)</text>
            }
        </h1>
        <div class="row">
            <div class="col-sm-6"><h4>@filter.Description</h4></div>
            <div class="col-sm-2 col-sm-offset-2">
                <a href="@url" class="btn btn-default">Change Search <span class="glyphicon glyphicon-search"></span></a>
            </div>
        </div>
    }
    else
    {
        // Simple Header
        var danceQuery = filter.DanceQuery;
        var isAzure = filter.IsAzure;

        using (Html.BeginForm(isAzure ? "AzureSearch" : "Search", "Song", FormMethod.Get, new { id = "search" }))
        {
            var danceName = (danceQuery.All || danceQuery.Advanced) ? "All Dances" : danceQuery.Dances.First().Name;

            <div class="row">
                <h1 class="col-sm-2" style="width: auto; font-size: 22px;">
                    Song Library
                </h1>
                <div class="col-sm-offset-2" style="margin-left: 1px">
                    <div class="input-group" style="margin-top: 1em">
                        <div class="input-group-btn search-panel">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" style="margin-left: 15px">
                                <span id="dance_selector">@danceName</span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li id="DID_ALL"><a href="#ALL"><strong>All Dances</strong></a></li>
                                @foreach (var sc in dances.OrderBy(x => x.DanceName))
                                {
                                    var id = "DID_" + sc.DanceId;
                                    var href = "#" + sc.DanceId;
                                    <li id="@id"><a href=@href><strong>@sc.DanceName</strong></a></li>
                                    foreach (var sci in sc.Children.OrderBy(x => x.DanceName))
                                    {
                                        if (sci.SongCount > 0)
                                        {
                                            id = "DID_" + sci.DanceId;
                                            href = "#" + sci.DanceId;
                                            <li id="@id"><a href=@href><small>&nbsp;@sci.DanceName</small></a></li>
                                        }
                                    }
                                }
                            </ul>
                        </div>
                        <input type="hidden" name="dances" id="dances" value="@filter.Dances" />
                        <input type="hidden" name="filter" id="filter" value="@filter.ToString()" />
                        <input type="hidden" name="tags" id="tags" />
                        @Html.TextBox("SearchString", filter.SearchString, new { @class = "form-control search-text", placeholder = "Artist, Title, Dance, Tags, etc...", id = "search-text" })
                        <span class="input-group-btn">
                            <button id="submit-search" class="btn btn-default" type="submit" style="margin-right: 15px"><span class="glyphicon glyphicon-search"></span></button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <p class="col-xs-6">  @Html.ActionLink("Saved Searches", "Index", "Searches", new { user = userName, filter }, new { id = "saved-search" })</p>
                <p class="col-xs-6" style="text-align: right; padding-right:20px">@Html.ActionLink("Advanced Search", "advancedsearchform", "song", new { filter }, new { id = "advanced-search" })</p>
            </div>
        }
    }
}
else
{
    // Custom Header
    var parts = description.Split('|');
    <h1>@parts[0]</h1>
    if (parts.Length > 1)
    {
        <div class="row">
            <h4 class="col-sm-12">@parts[1]</h4>
        </div>
    }
}