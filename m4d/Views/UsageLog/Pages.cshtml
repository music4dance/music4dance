@using m4d.ViewModels
@model m4d.Controllers.PageUsageModel

@{
    ViewBag.Title = "Usage Log - Pages";
    var items = Model.Summaries;

    var breadCrumbs = new List<BreadCrumbItem>
    {
        BreadCrumbItem.AdminItem,
        new() { Title = "Usage Log", Link = "/usagelog" },
        new() { Title = "Pages", Active = true },
    };

    ViewData["BreadCrumbs"] = breadCrumbs;
}

<h1>@ViewBag.Title</h1>

<div class="row my-1">
    <div class="col">
        Views:
    </div>
    <div class="col">
        @Html.ActionLink("High Usage", "Index", "UsageLog", null, new
            {
                @class = "btn btn-secondary",
                role = "button"
            })
    </div>
    <div class="col">
        @Html.ActionLink("Low Usage", "LowUsage", "UsageLog", null, new
            {
                @class = "btn btn-secondary",
                role = "button"
            })
    </div>
    <div class="col">
        @Html.ActionLink("Pages", "Pages", "UsageLog", null, new
            {
                @class = "btn btn-primary",
                role = "button"
            })
    </div>
</div>

<div class="row my-1">
    <div class="col">
        URL Mode:
    </div>
    <div class="col">
        @Html.ActionLink("Full URL", "Pages", "UsageLog", new { useBaseUrl = false }, new
            {
                @class = Model.UseBaseUrl ? "btn btn-secondary" : "btn btn-primary",
                role = "button"
            })
    </div>
    <div class="col">
        @Html.ActionLink("Base URL Only", "Pages", "UsageLog", new { useBaseUrl = true }, new
            {
                @class = Model.UseBaseUrl ? "btn btn-primary" : "btn btn-secondary",
                role = "button"
            })
    </div>
</div>

<div class="row my-1">
    <div class="col">Summary:</div>
    <div class="col">
        Count = @items.Count()
    </div>
    <div class="col">
        Last Refresh = @Model.LastUpdate.ToString()
    </div>
    <div class="col">
        @Html.ActionLink("Clear Cache", "ClearCache", "UsageLog", null, new
            {
                @class = "btn btn-primary",
                role = "button"
            })
    </div>
</div>

<div class="row">
    <div class="col">
    <table style="table-layout:fixed" class="table table-striped table-songs col-sm">
        <thead>
            <tr>
                <th scope="col" style="width:3em">
                    Hits
                </th>
                <th scope="col" style="width:3em">
                    Users
                </th>
                <th scope="col">
                    Page
                </th>
                <th scope="col" style="width:2em">
                    Days
                </th>
                <th scope="col" style="width:10em">
                    Min Date
                </th>
                <th scope="col" style="width:10em">
                    Max Date
                </th>
            </tr>
        </thead>
        <tbody>
        @foreach (var item in items)
        {
            <tr>
                <td>@item.Hits</td>
                <td>@item.UniqueUsers</td>
                <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="@item.Page">
                    @if (!string.IsNullOrEmpty(item.Page))
                    {
                        @Html.ActionLink(item.Page, "PageLog", new
                            {
                                page = item.Page,
                                exactMatch = !Model.UseBaseUrl
                            })
                    }
                </td>
                <td>
                    @(((item.MaxDate.LocalDateTime - item.MinDate.LocalDateTime).Days + 1).ToString())
                </td>
                <td>
                    @item.MinDate.LocalDateTime.ToString()
                </td>
                <td>
                    @item.MaxDate.LocalDateTime.ToString()
                </td>
            </tr>
        }
        </tbody>
    </table>
    </div>
</div>
