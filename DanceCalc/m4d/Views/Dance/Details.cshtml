@using System.Globalization
@using MarkdownDeep
@using m4d.Utilities
@model SongCounts

@{
    ViewBag.Title = Model.DanceName + " Information, Top Ten List, and Resources.";
    ViewBag.Description = "General information about the dance" + Model.DanceName + " along with a top ten song list, preferred tempo details, and other resources.";
    ViewBag.NoSort = true;
    ViewBag.ShowTempo = true;
    ViewBag.HideDances = true;
    ViewBag.SongFilter = new SongFilter { Dances = @Model.DanceId };

    var description = @"<p>We're busy doing research and pulling together a general description for " + Model.DanceName + @".  Please check back later for more info.</p>";
    if (!string.IsNullOrWhiteSpace(Model.Dance.Description))
    {
        var md = new Markdown { ExtraMode = true, SafeMode = false };
        description = Model.Dance.Description;
        description = Dance.SmartLinks(description, true);
        description = md.Transform(description);
    }

    var topSpotify = @DanceMusicService.PurchaseLinksToInfo(@Model.TopSpotify, User.Region());
    var tags = @Model.Dance.SongTags.Tags;
}

<ol class="breadcrumb">
    <li><a href="/">Music4Dance</a></li>
    <li><a href="/dances">Dances</a></li>
    @if (@Model.Parent != null && @Model.Parent.DanceId != "All")
    {
        <li><a href="/dances/@Model.Parent.SeoName">@Model.Parent.DanceName</a></li>
    }
    <li><a href="/dances/@Model.SeoName">@Model.DanceName</a></li>
</ol>

<h2>@Model.DanceName</h2>

<div class="row">
    <div class="col-md-8 big-text">@Html.Raw(description)</div>
    <div class="col-md-2 col-md-offset-1 list-group">
        @if (Model.TopSongs.Any())
        {
            <a href="#top-ten" class="list-group-item">Top Ten Songs</a>
            <a href="#spotify-player" class="list-group-item">Spotify Player</a>
        }
        @if (Model.Parent != null)
        {
            if (Model.Dance.Info.Meter.Numerator != 1)
            {
                <a href="#tempo-info" class="list-group-item">Tempo Info</a>
            }
        }
        else
        {
            <a href="#dance-styles" class="list-group-item">Dance Sytles</a>
        }
        @if (Model.Dance.DanceLinks != null && Model.Dance.DanceLinks.Count > 0)
        {
            <a href="#references" class="list-group-item">References</a>
        }
        @if (tags.Count > 0)
        {
            <a href="#tags" class="list-group-item">Tags</a>
        }
    </div>
</div>

@if (Model.TopSongs.Any())
{
    <div>
        <h3>@Html.ActionLink("music4dance's", "Index", "Home") top 10 songs for dancing @Html.ActionLink(@Model.DanceName, "Search", "Song", new { dances = @Model.DanceId }, null)</h3>
    </div>
    <div id="top-ten">
        @{Html.RenderPartial("_ListSongs", @Model.TopSongs, ViewData);}
    </div>

    <div id="spotify-player">
        <iframe src="https://embed.spotify.com/?uri=spotify:trackset:@Model.DanceName:@topSpotify" frameborder="0" allowtransparency="true"></iframe>
    </div>

    <div>
        <p>@Html.ActionLink("Browse", "search", "song", new { dances = @Model.DanceId }, null) all <b>@Model.SongCount</b> @Model.DanceName songs in the music4dance @Html.ActionLink("catalog", "index", "song").</p>
    </div>
}


@if (@Model.Parent != null && Model.Dance.Info.Meter.Numerator != 1)
{
    var info = Model.Dance.Info;
    var tempo = info.TempoRange;
    var oneTempo = tempo.Min == tempo.Max;
    var bpmMin = tempo.Min * info.Meter.Numerator;
    var bpmMax = tempo.Max * info.Meter.Numerator;
    var rangeText = (oneTempo) ? "at" : "between";
    var bpmText = bpmMin.ToString(CultureInfo.CurrentCulture) + (oneTempo ? string.Empty : " and " + bpmMax.ToString(CultureInfo.CurrentCulture)) + " beats per minute";
    var mpmText = tempo.MinString + (oneTempo ? string.Empty : " and " + tempo.MaxString) + " measures per mintue";
    <hr />
    <div id="tempo-info">
        <h4>Tempo Information</h4>
        <p>
            The @Model.DanceName is generally danced to music in a @info.Meter Meter
            @rangeText @mpmText (@bpmText)
            . @Html.ActionLink("Click here","advancedsearch","song", new {dances = @Model.DanceId,tempomin=@bpmMin,tempomax=@bpmMax}, null) to see a list of @Model.DanceName songs @rangeText @bpmText.
        </p>
        <p>
            <img src="~/Content/tools.png" alt="tools" width="24" height="24" />Use our tempi tool to find more infromation about tempi and to explore relationships between the meter and tempi of different dance styles.
            @SmartLink.TryIt("https://www.music4dance.net/home/tempi") @SmartLink.Docs("https://www.music4dance.net/blog/music4dance-help/dance-tempi/")
        </p>
    </div>
}

@if (@Model.CompetitionDances != null)
{
    <div id="category-info">
        @DanceHelper.CategoryTable(Html,Model.CompetitionDances,"Competition Tempo information:",DanceCategoryType.Both)
    </div>
}

@if (@Model.Parent == null)
{
    <hr />
    <div id="dance-styles">
        <h4>Dances that are grouped into the @Model.DanceName category.</h4>
        <div class="list-group">
            @{Html.RenderPartial("_DanceList", @Model.Children);}
        </div>
    </div>
}

@if (Model.Dance.DanceLinks != null && Model.Dance.DanceLinks.Count > 0)
{
    <hr />
    <h4 id="references">References</h4>
    <ul>
        @foreach (var dl in Model.Dance.DanceLinks)
        {
            <li><b>@dl.Description:</b> <a href="@dl.Link">@dl.Link</a></li>
        }
    </ul>
}


@if (tags.Count > 0)
{
    <hr />
    <h4 id="tags">Tags</h4>
    Html.RenderPartial("_TagCloud", tags);
}

<p>
    @if (User.IsInRole("canEdit"))
    {
        @Html.ActionLink("Edit", "Edit", new { id = Model.DanceId }, new { @class = "btn btn-default", role = "button" })
    }
</p>

@{
    string pageScript = "~/Scripts/showdance.js" + Page.ScriptQualifier;
    string msScript = "~/Scripts/musicservice.js" + Page.ScriptQualifier;
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="@Url.Content(msScript)" type="text/javascript"></script>
    <script src="@Url.Content(pageScript)" type="text/javascript"></script>
}

