@model m4dModels.SongDetails

@using (Html.BeginForm((string)ViewBag.Action, "Song", null, FormMethod.Post, new { @class="form-horizontal"}))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    m4dModels.SongDetails old = null;
    ViewBag.UseLogo = true;

    try
    {
        old = ViewBag.OldSong;
    }
    catch (Microsoft.CSharp.RuntimeBinder.RuntimeBinderException)
    {

    }

    @Html.HiddenFor(model => model.SongId)

    <div class="form-group">
        @Html.LabelFor(model => model.Title, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Title)
            @Html.ValidationMessageFor(model => model.Title)
            @if (old != null && !string.IsNullOrWhiteSpace(old.Title))
            {
                <div class="editor-alternate">
                    @old.Title
                </div>
            }
        </div>
    </div>
    
    <div class="form-group">
        @Html.LabelFor(model => model.Artist, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Artist)
            @Html.ValidationMessageFor(model => model.Artist)
            @if (old != null && !string.IsNullOrWhiteSpace(old.Artist))
            {
                <div class="editor-alternate">
                    @old.Artist
                </div>
            }
        </div>
    </div>
    
    <div class="form-group">
        @Html.LabelFor(model => model.Length, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Length,"SongDuration")
            @*@Html.ValidationMessageFor(model => model.Length)*@

            @if (old != null && old.Length != null)
            {
                <div class="editor-alternate">
                    @old.Length.Value
                </div>
            }
            </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Genre, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Genre)
            @Html.ValidationMessageFor(model => model.Genre)

            @if (old != null && old.Genre != null)
            {
                <div class="editor-alternate">
                    @old.Genre
                </div>
            }
            </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Tempo, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Tempo)
            @Html.ValidationMessageFor(model => model.Tempo)

            @if (old != null && old.Tempo != null)
            {
                <div class="editor-alternate">
                    @old.Tempo.Value
                </div>
            }
            <a href="#" id="toggle-count" class="btn btn-sm btn-default"><span id="toggle-count-display" class="glyphicon glyphicon-arrow-down"></span></a>
        </div>
    </div>
    <div class="form-group" id="counter-control">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <button id='count' type=button class="btn btn-lg btn-primary btn-block">Count</button>
            <div>@Html.Partial("_MeterChooser")</div>
            <div id="dances" class="list-group"></div>
            <input id='epsilon' type='range' value='5' min='1' max='50' />
        </div>
        <div class="col-md-2"></div>
    </div>
    <hr />
    <div class="display-label">
        Dance(s):
    </div>
    <div class="display-field">
        @{ var separator = ""; }
        @if (Model.DanceRatings != null)
    {
        foreach (var item in Model.DanceRatings)
        {
            @separator;
            @Html.DisplayFor(model => item.Dance.Info.Name)
            if (item.Weight > 1)
            {
                <b>(@item.Weight)</b>
            }
            separator = ", ";
        }
        <br />
    }
    </div>

    if (ViewData.ContainsKey("DanceListRemove"))
    {
    <div class="editor-label">
        Remove Dances from this list to vote them down.
    </div>
    <div class="editor-field">
        @Html.ListBox("remDances", ViewBag.DanceListRemove as MultiSelectList, new { @class = "chzn-select", data_placeholder = "Remove Dances to Vote Down..." })
    </div>
    }
    if (ViewData.ContainsKey("DanceListAdd"))
    {
    <div class="editor-label">
        Add dances to this list to vote them up.
    </div>
    <div class="editor-field">
        @Html.ListBox("addDances", ViewBag.DanceListAdd as MultiSelectList, new { @class = "chzn-select", data_placeholder = "Choose Dances to Vote Up..." })
    </div>
    <br />
    }

    <hr />
    <table>
        <tr><td></td><td class="album-header">Album</td><td class="track-header">Track</td><td class="publisher-header">Label</td><td class="delete-header"></td></tr>
        <tbody data-bind="foreach: albums">
            <tr data-bind="attr: {id: 'Album_' + $index()}">
                <td>
                    <div data-bind="ifnot: $index() == 0">
                        <a href="#" class="btn btn-sm btn-default">
                            <span id="toggle-count-display" class="glyphicon glyphicon-arrow-up" data-bind="click:$parent.promoteAlbum"></span>
                        </a>
                    </div>
                </td>
                <td>
                    <div class="editor-field">
                        <input data-bind="attr: {id: computeAlbumId($index(),'Name'), name: computeAlbumName($index(),'Name')}, value: Name" type="text" />
                    </div>
                </td>
                <td>
                    <div class="editor-field">
                        <input data-bind="attr: {id: computeAlbumId($index(),'Track'), name: computeAlbumName($index(),'Track')}, value: Track" type="text" />
                    </div>
                </td>
                <td>
                    <div class="editor-field">
                        <input data-bind="attr:{id: computeAlbumId($index(),'Publisher'), name: computeAlbumName($index(),'Publisher')}, value: Publisher" type="text" />
                    </div>
                </td>
                <td>
                    <button type="button" data-bind="attr: {id: 'Delete_' + $index()}, click: $parent.removeAlbum">X</button>
                    <input data-bind="attr:{id: computeAlbumId($index(),'PurchaseInfo'), name: computeAlbumName($index(),'PurchaseInfo')}, value:PurchaseInfo" type="hidden" />
                    <input data-bind="attr: {id: computeAlbumId($index(),'Index'), name: computeAlbumName($index(),'Index')}, value:Index" type="hidden" />
                </td>
                <td>
                    <div data-bind="foreach: PurchaseLinks">
                        <a data-bind="attr: {href:Link, target:Target}"><img data-bind="attr: {src:'/Content/' + Logo(), alt: AltText}" /></a>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <a class="btn btn-info" role="button" id="AddAlbum" data-bind="click: newAlbum">New Album</a>
    <hr />
    
    <h3>Music Services</h3>
    <input class="text-box single-line" placeholder="leave blank to use title + artist" id="search" type="text" width="75"/>
    <button type="button" id="load-all"  class="btn btn-small btn-default" role="button">Search All</button>
    <button type="button" id="load-xbox"  class="btn btn-small btn-default" role="button">Xbox</button>
    <button type="button" id="load-itunes"  class="btn btn-small btn-default" role="button">ITunes</button>
    <button type="button" id="load-amazon"  class="btn btn-small btn-default" role="button">Amazon</button>

    <table id="service-results" class="table table-striped">
        <thead>
            <tr>
                <th></th>
                <th>Add</th>
                <th>Name</th>
                <th>Album</th>
                <th>Artist</th>
                <th>#</th>
                <th>Length</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: tracks">
            <tr>
                <td><a data-bind="attr: {href: SongLink.Link}" class="btn" role="button"><img width="30" height="30" data-bind="attr: {src: serviceLogo}" /></a></td>
                <td><a href="#" class="btn" role="button" data-bind="click: $parent.chooseTrack"><img width="30" height="30" data-bind="attr: {src: ImageUrl}" /></a></td>
                <td data-bind="text: Name"></td>
                <td data-bind="text: Album"></td>
                <td data-bind="text: Artist"></td>
                <td data-bind="text: TrackNumber"></td>
                <td data-bind="text: durationFormatted"></td>
            </tr>
        </tbody>
    </table>
    
    <img src="~/Content/ajax-loader.gif" id="loading-indicator" style="display:none" />

    <hr />
    <div class="display-label">
        @Html.DisplayNameFor(model => model.Created):
    </div>
    <div class="display-field">
        @Html.DisplayFor(model => model.Created)
        @Html.HiddenFor(model => model.Created)
    </div>
    <br />

    <div class="display-label">
        @Html.DisplayNameFor(model => model.Modified):
    </div>
    <div class="display-field">
        @Html.DisplayFor(model => model.Modified)
    </div>

    <hr />

    <p>
        <input type="hidden" name="filter" value="@ViewBag.SongFilter" />
        <input type="submit" value="@ViewBag.Submit" class="btn btn-default" />
    </p>
    }

