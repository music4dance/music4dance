@model m4dModels.SongDetails
@using System.Runtime.Serialization.Json

@{
    ViewBag.Title = "Edit";
    ViewBag.Action = "Edit";
    ViewBag.Submit = "Save";
}

<h2>Edit</h2>

@Html.Partial("EditCore")

<div>
    @Html.ActionLink("Back to List", (string)ViewBag.SongFilter.Action, new { filter = ViewBag.SongFilter }, new { @class = "btn btn-small btn-primary", role = "button" })
</div>

@section Scripts {
    @{
        string pageScript = "~/Scripts/edit.js" + Page.ScriptQualifier;
        string counterScript = "~/Scripts/counter.js" + Page.ScriptQualifier;
        if (ViewData.ContainsKey("paramNumerator"))
        {
            <script>var paramNumerator = @ViewBag.paramNumerator;</script>
        }
        MemoryStream stream = new MemoryStream();
        DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(IEnumerable<m4dModels.AlbumDetails>));
        serializer.WriteObject(stream, Model.Albums);
        string albumsString = System.Text.Encoding.UTF8.GetString(stream.ToArray());
    }
    <script>
        var paramShowMPM = true;
        var paramShowBPM = true;
        var paramEpsVisible = 0.1;
        var songId = '@Model.SongId.ToString()';
        var albums = @Html.Raw(albumsString);
    </script>

    @Scripts.Render("~/bundles/jqueryval")
    <script src="@Url.Content("~/Scripts/chosen.jquery.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/chosen.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/knockout-3.1.0.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/knockout.mapping-latest.js")" type="text/javascript"></script>
    <script>
        $(".chzn-select").chosen({ width: "500px" });
        var albumCount = @Model.Albums.Count-5;
        var albumsAdded = 0;
    </script>
    <script src="@Url.Content(pageScript)" type="text/javascript"></script>
    <script src="@Url.Content(counterScript)" type="text/javascript"></script>
}
