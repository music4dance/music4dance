@model DanceLibrary.Dances

@{
    ViewBag.Title = "Tempi";
    ViewBag.Description = "A web application that catalogs dance styles by the tempo to which they can be danced both socially and by the standards of several organizers of dance competitions."
}

<div class="row">
    <div class="dropdown col-md-3">
        <a id="filter-style" role="button" data-toggle="dropdown" data-target="#" href="/Home/Tempi" class="btn btn-info btn-block filter-button">
            All Styles <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="filter-style">
            @foreach (var element in @Model.Styles)
            {
                string id = "filter-style-" + element.Key;
                <li><a id="@id" href="#">@element.Value</a></li>
            }
        </ul>
    </div>
    <div class="dropdown col-md-3">
        <a id="filter-meter" role="button" data-toggle="dropdown" data-target="#" href="/Home/Tempi" class="btn btn-info btn-block filter-button">
            All Meters <span class=" caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="filter-meter">
            <li><a id="filter-meter-1" href="#">All Meters</a></li>
            <li><a id="filter-meter-2" href="#">2/4 MPM</a></li>
            <li><a id="filter-meter-3" href="#">3/4 MPM</a></li>
            <li><a id="filter-meter-4" href="#">4/4 MPM</a></li>
        </ul>
    </div>
    <div class="dropdown col-md-3">
        <a id="filter-type" role="button" data-toggle="dropdown" data-target="#" href="/Home/Tempi" class="btn btn-info btn-block filter-button">
            All Types <span class=" caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="filter-type">
            <li><a id="filter-type-ALL" href="#">All Types</a></li>
            @foreach (var item in Model.AllDanceGroups)
            {
                string id = "filter-type-" + item.Id;
                <li><a id="@id" href="#">@item.Name</a></li>
            }
        </ul>
    </div>
    <div class="dropdown col-md-3">
        <a id="filter-org" role="button" data-toggle="dropdown" data-target="#" href="/Home/Tempi" class="btn btn-info btn-block filter-button">
            All Organizations <span class=" caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="filter-meter">
            @for (int i = 0; i < Model.Organizations.Length; i++)
            {
                string id = "filter-org-" + i.ToString();
                <li><a id="@id" href="#">@Model.Organizations[i].Title</a></li>
            }
        </ul>
    </div>
</div>

<div class="row">
    <table class="table table-striped table-bordered col-md-12">
        <thead>
            <tr data-bind="foreach: headers">
                <td data-bind="visible: show"><a data-bind="click: $parent.sort, text: title" class="btn btn-link"></a></td>
            </tr>
        </thead>
        <tbody data-bind="foreach: filteredDances">
            <tr>
                <td><a data-bind="text: Name, attr: {href: '/Dances/' + Name}"></a></td>
                <td align="center"><span data-bind="text: Meter.Numerator"></span>/<span data-bind="text: Meter.Denominator"></span></td>
                <td align="center" data-bind="html: tempoMPM"></td>
                <td align="center" data-bind="html: tempoDS, visible: $parent.showDanceSport"></td>
                <td align="center" data-bind="html: tempoNDCA, visible: $parent.showNDCA_A"></td>
                <td align="center" data-bind="html: tempoNDCABeginner, visible: $parent.showNDCA_B"></td>
                <td align="center" data-bind="html: tempoBPM"></td>
                <td><a data-bind="text: GroupName, attr: {href: '/Dances/' + GroupName}"></a></td>
                <td data-bind="html: styles"></td>
            </tr>
        </tbody>
    </table>
</div>

<div class="row">
    <div class="col-md-6">
        <a id="reset" role="button" data-target="#" href="/Home/Tempi" class="btn btn-info btn-block">Reset</a>
    </div>
    <div class="checkbox col-md-6">
        <label>
            <input id="details" type="checkbox" data-bind="checked: showDetails"/> Show Details
        </label>
    </div>
</div>

<div class="row" data-bind="visible: showDetails"> 
    <p>(*) A short explanation of the NDCA (National Dance Council of America) columns: For American style dances the "A" column contains Tempi for Silver and Gold levels while the "B" column contains Tempi for Bronze level.  For International style dances the "A" column contains Tempi for Professional and Amateur couples while the "B" column contains Tempi for Pro/Am couples. </p>
    <p>Dancesport Tempi are pulled from here: <a href="http://www.worlddancesport.org/Rule/Athlete/Competition">http://www.worlddancesport.org/Rule/Athlete/Competition</a></p>
    <p>NDCA (National Dance Council of America) Tempi are pulled from here: <a href="http://ndca.org/education/dances-and-tempi/">http://ndca.org/education/dances-and-tempi/</a></p>
    <p>If there are other organizations that you would like to see included in this list, please <a href="mailto:david@music4dance.net">contact us</a> and we'll be happy to take a look.</p>
</div>

@section Scripts {

    <script>
        var danceTypes = [
            {id: "ALL", name: "All Types"},
            @foreach (var item in Model.AllDanceGroups)
            {
                <text>{id:"@item.Id",name:"@item.Name"},</text>
            }
        ];
        var danceStyles = [
            @foreach (var item in Model.Styles)
            {
                <text>{ id: "@item.Key", name: "@item.Value" },</text>
            }
        ];
        var danceOrgs = [
            @foreach (var item in Model.Organizations)
            {
                <text>{ title: "@item.Title", name: "@item.Name", category:"@item.Category", qualifier:"@item.Qualifier"},</text>
            }
        ];
    </script>
    @{
        bool paramDetailed = false;
        int paramStyle = 0;
        int paramMeter = 1;
        int paramType = 0;
        int paramOrg = 0;
        
        if (ViewData.ContainsKey("paramDetailed"))
        {
            paramDetailed = @ViewBag.paramDetailed;
        }
        if (ViewData.ContainsKey("paramStyle"))
        {
            paramStyle = @ViewBag.paramStyle;
        }
        if (ViewData.ContainsKey("paramMeter"))
        {
            paramMeter = @ViewBag.paramMeter;
        }
        if (ViewData.ContainsKey("paramType"))
        {
            paramType = @ViewBag.paramType;
        }
        if (ViewData.ContainsKey("paramOrg"))
        {
            paramOrg = @ViewBag.paramOrg;
        }
        <script>
            var paramDetailed = @(paramDetailed ? "true" : "false");
            var paramStyle = @paramStyle;
            var paramMeter = @paramMeter;
            var paramType = @paramType;
            var paramOrg = @paramOrg;

            var dances = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.AllDanceTypes));
        </script>
        string pageScript = "~/Scripts/Tempi.js" + Page.ScriptQualifier;
        Scripts.Render("~/bundles/jqueryval");
    }
    <script src="@Url.Content("~/Scripts/knockout-3.2.0.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/knockout.mapping-latest.js")" type="text/javascript"></script>
    <script src="@Url.Content(pageScript)" type="text/javascript"></script>
}
