@using System.Web.Mvc.Html
@using DanceLibrary
@using m4dModels

@helper ShowTempo(System.Web.Mvc.HtmlHelper html, TempoRange range, Meter meter, string danceId)
{
    var bpm = range.ToBpm(meter);
    @html.ActionLink(range.ToString(), "advancedsearch", "song", new { dances = danceId, tempomin = bpm.Min, tempomax = bpm.Max }, null)
}

@helper CategoryTable(System.Web.Mvc.HtmlHelper html, IEnumerable<CompetitionDance> dances, string title, DanceCategoryType dct)
{
    var dctIn = dct;
    var danceList = (dances as IList<CompetitionDance>) ?? dances.ToList();
    if (dct == DanceCategoryType.Both && danceList.All(cd => cd.SpecificDance.StyleId == danceList[0].SpecificDance.StyleId))
    {
        dct = (danceList[0].SpecificDance.StyleId == 'I') ? DanceCategoryType.International : DanceCategoryType.American;
    }
    string ndcaTitleA = null;
    string ndcaTitleB = null;
    switch (dct)
    {
        case DanceCategoryType.Both:
            ndcaTitleA = "A (*)";
            ndcaTitleB = "B (*)";
            break;
        case DanceCategoryType.American:
            ndcaTitleA = "Pro/Am";
            ndcaTitleB = "Bronze";
            break;
        case DanceCategoryType.International:
            ndcaTitleA = "Professional or Amateur";
            ndcaTitleB = "Silver/Gold";
            break;
    }
    <table class="table table-striped table-bordered">
        <thead>@title</thead>
        <tr>
            <th>Name</th>
            <th>Meter</th>
            <th>MPM</th>
            <th>DanceSport</th>
            <th>NDCA @ndcaTitleA</th>
            <th>NDCA @ndcaTitleB</th>
            <th>BPM</th>
        </tr>
        @foreach (var cat in danceList)
        {
            var sc = cat.SongCount;
            var d = cat.SpecificDance;

            var name = dctIn == DanceCategoryType.Both ? d.Style : sc.DanceName;
            var link = dctIn == DanceCategoryType.Both ? DanceObject.SeoFriendly(d.Style) : sc.SeoName;
            <tr>
                <td>@html.ActionLink(name, link, "dances") </td>
                <td>@d.Meter</td>
                <td>@ShowTempo(html,d.TempoRange, d.Meter, sc.DanceId)</td>
                <td>@ShowTempo(html, d.DanceSportTempo, d.Meter, sc.DanceId)</td>
                <td>@ShowTempo(html, d.NDCATempoA, d.Meter, sc.DanceId)</td>
                <td>@ShowTempo(html, d.NDCATempoB, d.Meter, sc.DanceId)</td>
                <td>@d.TempoRange.ToBpm(d.Meter)</td>
            </tr>
        }
    </table>
    if (dct == DanceCategoryType.Both)
    {
        <p>(*) A short explanation of the NDCA (National Dance Council of America) columns: For American style dances the "A" column contains Tempi for Silver and Gold levels while the "B" column contains Tempi for Bronze level. For International style dances the "A" column contains Tempi for Professional and Amateur couples while the "B" column contains Tempi for Pro/Am couples. </p>
    }
}

@helper FullRoundName(DanceCategory category)
{
    @category.Name @(category.Round.Count == 4 ? " four " : " five " )
}

@helper LinkCategory(System.Web.Mvc.HtmlHelper html, string name)
{
    @html.ActionLink(name, DanceObject.SeoFriendly(name), "dances");
}

