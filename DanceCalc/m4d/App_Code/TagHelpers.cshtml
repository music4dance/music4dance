@using m4dModels
@helper TagButton(TagCount tag, SongFilter filter, float cloudSize = 0)
{
    var buckets = new float[] {.25F,.5F,.75F,1,5,10,20,25,50,100};
    var sizes = new int[] {14,16,18,20,22,24,26,28,30,32};
    var iconSize = 14;
    
    var filterString = string.Empty;
    if (filter != null)
    {
        filterString = "&filter=" + WebUtility.UrlEncode(filter.ToString());
    }
    var tc = tag.TagClass.ToLower();
    var url = "/song/addtags?tags={0}" + WebUtility.UrlEncode(tag.TagValue) + ":" + WebUtility.UrlEncode(tag.TagClass) + filterString;
    var ic = "tag";
    switch (tc)
    {
        case "style":
            ic = "dance";
            break;
        case "tempo":
            ic = "tempo";
            break;
        case "music":
            ic = "genre";
            break;
    }
    var img = "/Content/" + ic + "-50.png";

    var size = string.Empty;
    if (cloudSize > 0)
    {
        var perc = tag.Count / cloudSize;
        var bucket = 0;
        while (bucket < buckets.Length-1 && buckets[bucket] < perc)
        {
            bucket += 1;
        }
        size = "cloud-" + bucket;
        iconSize = sizes[bucket];
    }

    <div class="btn-group @size">
        <a href="#!" role="button" class="dropdown-toggle label label-@tc" data-toggle="dropdown" aria-expanded="false"><img src="@img" height="@iconSize.ToString()" width="@iconSize.ToString()" /> @tag.TagValue</a>
        <ul class="dropdown-menu" role="menu">
            <li><a href="@string.Format(url,"%2B")">Include songs tagged as @tag.TagValue</a></li>
            <li><a href="@string.Format(url,"%2D")">Exclude songs tagged as @tag.TagValue</a></li>
        </ul>
    </div>
}
